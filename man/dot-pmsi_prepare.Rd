% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/pmsi.R
\name{.pmsi_prepare}
\alias{.pmsi_prepare}
\title{Prepare raw PMSI stay payload for downstream tabulation}
\usage{
.pmsi_prepare(data)
}
\arguments{
\item{data}{List of PMSI API entries (one list per stay). Each entry may be a
nested list.}
}
\value{
A tibble with one row per stay and flattened columns. When `DATENT`
  and/or `DATSORT` are present, they are converted to `POSIXct` and
  `HEURE_DATENT` / `HEURE_DATSORT` are added as `hms`. If a date column is
  absent, the corresponding `HEURE_*` column is still created and filled with
  `NA`.
}
\description{
Flattens a list of PMSI API stay entries into a single tibble and standardizes
column values. Nested structures are recursively unlisted; empty or missing
values become `NA_character_`, and multi-valued fields are collapsed with `;`.
}
\details{
If present, `DATENT` and `DATSORT` are parsed to `POSIXct` using
`.pmsi_parse_datetime()`. For each, a corresponding `HEURE_*` column is added
using `.pmsi_time_hms()`, containing an `hms` time only when the raw string
included an explicit time component; otherwise it is `NA`.


Value normalization rules applied per field after flattening:
- `NULL` or length 0  --> `NA_character_`
- length > 1          --> `paste(..., collapse = ";")`
- otherwise           --> `as.character(v)`
}
\examples{
x <- list(
  list(PATID = "P1", EVTID = "E1", DATENT = "2020-01-01 08:30",
       DATSORT = "2020-01-02", SOME = c("a","b")),
  list(PATID = "P2", EVTID = "E2", DATENT = NULL)
)
out <- .pmsi_prepare(x)
out$SOME  # "a;b"
out$HEURE_DATSORT  # NA for date-only values

}
\keyword{internal}
