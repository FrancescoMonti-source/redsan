% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/pmsi.R
\name{.pmsi_actes}
\alias{.pmsi_actes}
\title{Extract PMSI actes in long format}
\usage{
.pmsi_actes(data)
}
\arguments{
\item{data}{A tibble produced by `.pmsi_prepare()`.}
}
\value{
A tibble in long format, with at least the columns:
  `PATID`, `EVTID`, `ELTID`, `PATBD`, `PATAGE`, `PATSEX`, `DATENT`,
  `HEURE_DATENT`, `DATSORT`, `HEURE_DATSORT`, `SEJDUR`, `SEJUM`, `SEJUF`,
  plus acte fields such as `CODEACTE`, `DATEACTE`, `UFPRO`, `UFDEM`,
  `NOMENCLATURE` when present. Rows with all acte values missing are dropped
  (`values_drop_na = TRUE`). Duplicates are removed with `distinct()`.
}
\description{
Builds an actes table (one row per acte occurrence) from prepared PMSI stay
data. The function keeps stay identifiers and key context variables, then
pivots acte-related columns (e.g., `CODEACTE*`, `DATEACTE*`, `UFPRO*`, `UFDEM*`,
`NOMENCLATURE*`) from wide to long using a `.value` pivot.
}
\details{
This function assumes `DATENT` and `DATSORT` are already parsed as `POSIXct`
and `HEURE_*` columns are already created by `.pmsi_prepare()`.


The pivot is driven by:
- `names_pattern = "(CODEACTE|DATEACTE|UFPRO|UFDEM|NOMENCLATURE).*"`
- `names_to = c(".value")`

This collapses columns that share the same acte index/suffix into a single
row, producing canonical columns named exactly as the captured groups
(`CODEACTE`, `DATEACTE`, `UFPRO`, `UFDEM`, `NOMENCLATURE`).
}
\examples{
x <- list(list(
  PATID="P1", EVTID="E1", ELTID="L1",
  DATENT="2020-01-01 08:30",
  CODEACTE1="A123", DATEACTE1="2020-01-01 09:00", UFPRO1="01"
))
cleaned <- .pmsi_prepare(x)
actes <- .pmsi_actes(cleaned)

}
\keyword{internal}
